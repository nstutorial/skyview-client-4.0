<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Skyview Marksheet</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        body {
/*              background: url('https://svps.skyviewpublicschool.in/assets/images/watermark3.png') no-repeat center center;
             background-size: cover; */
            background-color: #f5f5f5;
            font-size: 15px;
            font-family: 'Times New Roman', Times, serif;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            text-rendering: optimizeLegibility;
        }

        .marksheet-container {
            max-width: 1200px;
            margin: 20px auto;
            background: white;
            padding: 20px;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.1);
            position: relative;
            overflow: hidden;
            border: 2px solid #000;
        }

        .marksheet-inner {
            border: 1px solid #000;
            padding: 20px;
            position: relative;
            background:
                linear-gradient(45deg, #000 12px, transparent 0) 0 0,
                linear-gradient(-45deg, #000 12px, transparent 0) 100% 0,
                linear-gradient(135deg, #000 12px, transparent 0) 0 100%,
                linear-gradient(-135deg, #000 12px, transparent 0) 100% 100%;
            background-size: 30px 30px;
            background-repeat: no-repeat;
        }

/*         .watermark {
            position: fixed;
            top: 50%;
            left: 50%;
            font-size: 72px;
            color: rgba(128, 128, 128, 0.1);
            pointer-events: none;
            z-index: -1;
            -webkit-transform: translate(-50%, -50%) rotate(-45deg);
            -moz-transform: translate(-50%, -50%) rotate(-45deg);
            -ms-transform: translate(-50%, -50%) rotate(-45deg);
            transform: translate(-50%, -50%) rotate(-45deg);
            -webkit-transform-origin: center;
            -moz-transform-origin: center;
            -ms-transform-origin: center;
            transform-origin: center;
        } */

         /* Watermark text */
            .watermark {
                display: block;
                content: "";
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: url('../assets/images/watermark3.png') no-repeat center center;
                background-size: 100% 100%;
                opacity: 0.1;
                z-index: -1;
                print-color-adjust: exact !important;
                -webkit-print-color-adjust: exact !important;
                transform: rotate(0deg);
            }
       
        .school-header {
            text-align: center;
            margin-bottom: 15px;
            border-bottom: 2px solid #333;
            padding-bottom: 10px;
        }

        .school-logo {
            width: 60px;
            height: 60px;
            margin-bottom: 5px;
        }

        .school-header h2 {
            margin: 5px 0;
            font-size: 35px;
            font-family: 'Times New Roman', Times, serif;
            font-weight: 700;
            letter-spacing: 0.3px;
             color: #1600fd;
        }

        .school-header p {
            margin: 2px 0;
            font-size: 15px;
            font-family: Arial, Helvetica, sans-serif;
            font-weight: 500;
        }

        .student-info {
            margin-bottom: 15px;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 5px;
            font-size: 14px;
            font-family: Consolas, monospace;
            background-color: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 5px;
            padding: 15px;
            margin-bottom: 20px;
        }

        .student-info p {
            margin-bottom: 5px;
        }

        .student-info strong {
            font-weight: 700;
        }

        .marks-table {
            font-size: 13px;
            font-family: Consolas, monospace;
        }

        .marks-table th {
            background-color: #e9ecef !important;
            text-align: center;
            vertical-align: middle;
            padding: 4px !important;
            font-size: 13px;
            white-space: nowrap;
            font-weight: 600;
            letter-spacing: 0.2px;
            color: #000;
        }

        .marks-table td {
            text-align: center;
            vertical-align: middle;
            padding: 3px !important;
        }

        .marks-table td:first-child {
            font-weight: 700;
            font-size: 15px;
        }

        .marks-input {
            width: 50px !important;
            display: inline-block !important;
            text-align: center;
            padding: 1px !important;
            font-size: 15px !important;
            height: 28px !important;
            font-family: 'Times New Roman', Times, serif;
            font-weight: 600;
        }

        .result-summary {
            display: none;
            margin: 15px 0;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 5px;
            font-size: 14px;
            font-family: Consolas, monospace;
            background-color: #f8f9fa;
            border: 1px solid #000;
            position: relative;
            z-index: 2;
            border-radius: 0;
        }

        .result-summary p {
            margin-bottom: 0;
        }

        .result-summary strong {
            font-weight: 600;
        }

        .grade-info {
            font-size: 13px;
            margin: 10px 0;
            padding: 10px;
            background: #fff;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-family: Consolas, monospace;
            background-color: #fff;
            border-top: 1px solid #dee2e6;
            padding-top: 10px;
            margin-top: 15px;
            font-size: 10px;
        }

        .grade-info h6 {
            font-weight: 600;
            font-size: 14px;
        }

        .signatures {
            margin-top: 30px;
            padding-top: 20px;
            /* border-top: 1px solid #ddd; */
        }

        .signatures p {
            font-weight: 600;
            letter-spacing: 0.2px;
        }

        .signature-line {
            border-top: 1px solid #333;
            width: 80%;
            margin: 5px auto;
        }

        .total-cell {
            background-color: #f8f9fa !important;
            font-weight: bold;
        }

        .table> :not(caption)>*>* {
            padding: 0.25rem;
        }

        .co-scholastic-area,
        .signatures,
        .general-info,
        .promotion-status {
            font-size: 13px;
            font-family: Consolas, monospace;
        }

        .display-none {
            display: none;
        }

        @media print {   
            
            @page {
                size: A4;
                margin: 0.5cm;
            }

            body {
                margin: 0;
                padding: 0;
                font-size: 12px;
                -webkit-print-color-adjust: exact !important;
                print-color-adjust: exact !important;
            }
        
            .marksheet-container {
                max-width: none;
                width: 100%;
                margin: 0;
                padding: 10px;
                box-shadow: none;
                min-height: fit-content;
                background: white;
            }

            .marksheet-inner {
                padding: 25px;
                position: relative;
                background: white;
            }

            /* Outer border with double line */
            .marksheet-inner::before {
                content: '';
                position: absolute;
                top: 0;
                right: 0;
                bottom: 0;
                left: 0;
                border: 3px double #1600fd;
            }

            /* Inner border */
            .marksheet-inner::after {
                content: '';
                position: absolute;
                top: 10px;
                right: 10px;
                bottom: 10px;
                left: 10px;
                border: 1px solid #1600fd;
            }

            .marksheet-content {
                position: relative;
                z-index: 1;
                background: white;
                padding: 15px;
            }

            /* Ornamental corners */
            .corner {
                position: absolute;
                width: 25px;
                height: 25px;
                z-index: 2;
            }

            .corner::before,
            .corner::after {
                content: '';
                position: absolute;
                background: #1600fd;
            }

            .corner::before {
                width: 15px;
                height: 3px;
            }

            .corner::after {
                width: 3px;
                height: 15px;
            }

            .corner-top-left {
                top: 10px;
                left: 10px;
            }

            .corner-top-left::before,
            .corner-top-left::after {
                top: 0;
                left: 0;
            }

            .corner-top-right {
                top: 10px;
                right: 10px;
            }

            .corner-top-right::before {
                top: 0;
                right: 0;
            }

            .corner-top-right::after {
                top: 0;
                right: 0;
            }

            .corner-bottom-left {
                bottom: 10px;
                left: 10px;
            }

            .corner-bottom-left::before {
                bottom: 0;
                left: 0;
            }

            .corner-bottom-left::after {
                bottom: 0;
                left: 0;
            }

            .corner-bottom-right {
                bottom: 10px;
                right: 10px;
            }

            .corner-bottom-right::before {
                bottom: 0;
                right: 0;
            }

            .corner-bottom-right::after {
                bottom: 0;
                right: 0;
            }

            .school-header {
                margin-bottom: 15px;
                padding-bottom: 10px;
                border-bottom: 3px double #1600fd;
                position: relative;
                text-align: center;
            }

            .school-header h2 {
                font-size: 35px;
                margin: 3px 0;
                color: #1600fd;
                font-weight: bold;
            }

            .school-header p {
                margin: 5px 0;
                font-size: 12px;
            }

            .student-info {
                padding: 12px;
                margin: 15px 0;
                font-size: 16px;
                border: 2px solid #1600fd;
                position: relative;
                background: white;
            }

            .info-font {
                font-size: 16px;
            }

            .marks-table {
                margin: 15px 0;
            }

            .marks-table table,
            .co-scholastic-area table {
                border: 2px solid #1600fd !important;
                width: 100%;
            }

            .marks-table th,
            .marks-table td,
            .co-scholastic-area th,
            .co-scholastic-area td {
                padding: 5px !important;
                border: 1px solid #1600fd !important;
                font-size: 12px !important;
            }

            .marks-table th {
                background-color: #f0f3ff !important;
                font-weight: bold !important;
            }

            .table-secondary {
                background-color: #f0f3ff !important;
            }

            .grade-info {
                margin: 15px 0;
                padding: 12px;
                font-size: 12px;
                border: 2px solid #1600fd;
                background: white;
            }

            /* Ensure page breaks don't occur within important sections */
            .student-info,
            .marks-table,
            .co-scholastic-area,
            .signatures {
                page-break-inside: avoid;
            }

            /* Remove flag icon */
            .watermark img {
                display: none !important;
            }

            /* Watermark text */
            .watermark {
                display: block;
                content: "";
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: url('../assets/images/watermark3.png') no-repeat center center;
                background-size: 100% 100%;
                opacity: 0.1;
                z-index: 999;
                print-color-adjust: exact !important;
                -webkit-print-color-adjust: exact !important;
                transform: rotate(0deg);
            }
            /* Hide all buttons and controls */
            .no-print,
            .btn,
            button,
            .d-flex.justify-content-between.mb-3 {
                display: none !important;
            }
        }
    </style>
</head>

<body>
    <div class="container marksheet-container">
        <div class="marksheet-inner">
            <div class="watermark"></div>
            <div class="d-flex justify-content-between mb-3 no-print">
                <button id="saveMarks" class="btn btn-success">
                    <i class="fas fa-save"></i> Save Marks
                </button>
                <button class="btn btn-primary" onclick="window.print()">
                    <i class="fas fa-print"></i> Print Marksheet
                </button>
            </div>

            <div class="school-header">
                <img src="../assets/images/logo.png" alt="School Logo" class="school-logo">
                <h2>SKYVIEW PUBLIC SCHOOL</h2>
                <p>Uttar Andaranfulbari, Tufanganj, Coochbehar, WB, PIN- 736160</p>
                <p>Contact No. +91-86535-54323 | Email: skyviewpublicschool@gmail.com</p>
                <h4 class="mt-2">STUDENT PROGRESS REPORT</h4>
            </div>

            <div class="student-info">
                <div class="row g-2 info-font">
                    <div class="col-6 col-print-6">
                        <p class="mb-1"><strong>Student Name:</strong> <span id="studentName"></span></p>
                        <p class="mb-1"><strong>Class:</strong> <span id="className"></span></p>
                        <p class="mb-1 no-print display-none"><strong>Date of Birth:</strong> <span id="dob"></span></p>
                        <p class="mb-1"><strong>Roll No:</strong> <span id="rollNo"></span></p>
                    </div>
                    <div class="col-6 col-print-6">
                        <p class="mb-1"><strong>Admission No:</strong> <span id="admissionNo"></span></p>
                        <p class="mb-1"><strong>Section:</strong> <span id="section"></span></p>
                        <p class="mb-1"><strong>Academic Year:</strong> <span id="academicYear"></span></p>
                    </div>
                </div>
            </div>

            <div class="marks-table">
                <table class="table table-bordered">
                    <thead>
                        <tr>
                            <th rowspan="2">Subject</th>
                            <th colspan="3">Periodic Test 1</th>
                            <th colspan="3">Half Yearly</th>
                            <th colspan="3">Periodic Test 2</th>
                            <th colspan="3">Final Exam</th>
                        </tr>
                        <tr>
                             <th>Written<br><span id="pt1WrittenMax">(80)</span></th>
                            <th>Oral<br><span id="pt1OralMax">(20)</span></th>
                            <th>Total<br><span id="pt1TotalMax">(100)</span></th>
                            <th>Written<br><span id="hyWrittenMax">(80)</span></th>
                            <th>Oral<br><span id="hyOralMax">(20)</span></th>
                            <th>Total<br><span id="hyTotalMax">(100)</span></th>
                            <th>Written<br><span id="pt2WrittenMax">(80)</span></th>
                            <th>Oral<br><span id="pt2OralMax">(20)</span></th>
                            <th>Total<br><span id="pt2TotalMax">(100)</span></th>
                            <th>Written<br><span id="finalWrittenMax">(80)</span></th>
                            <th>Oral<br><span id="finalOralMax">(20)</span></th>
                            <th>Total<br><span id="finalTotalMax">(100)</span></th>
                        </tr>
                    </thead>
                    <tbody id="marksTableBody">
                    </tbody>
                    <tfoot>
                        <tr class="table-secondary">
                            <td colspan="2"><strong>Grand Total</strong></td>
                            <td colspan="0"></td>
                            <td id="pt1Total">0</td>
                            <td colspan="2"></td>
                            <td id="hyTotal">0</td>
                            <td colspan="2"></td>
                            <td id="pt2Total">0</td>
                            <td colspan="2"></td>
                            <td id="finalTotal">0</td>
                        </tr>
                        <tr class="table-secondary">
                            <td colspan="2"><strong>Percentage</strong></td>
                            <td colspan="0"></td>
                            <td id="pt1Percentage">0%</td>
                            <td colspan="2"></td>
                            <td id="hyPercentage">0%</td>
                            <td colspan="2"></td>
                            <td id="pt2Percentage">0%</td>
                            <td colspan="2"></td>
                            <td id="finalPercentage">0%</td>
                        </tr>
                        <tr class="table-secondary no-print">
                            <td colspan="2"><strong>Grade</strong></td>
                            <td colspan="0"></td>
                            <td id="pt1Grade">-</td>
                            <td colspan="2"></td>
                            <td id="hyGrade">-</td>
                            <td colspan="2"></td>
                            <td id="pt2Grade">-</td>
                            <td colspan="2"></td>
                            <td id="finalGrade">-</td>
                        </tr>
                        <tr class="table-secondary">
                            <td colspan="2"><strong>Overall Percentage</strong></td>
                            <td colspan="12" class="text-center" id="overallPercentage">0%</td>
                        </tr>
                        <tr class="table-secondary">
                            <td colspan="2"><strong>Overall Grade</strong></td>
                            <td colspan="12" class="text-center" id="overallGrade">-</td>
                        </tr>
                        <tr class="table-secondary">
                            <td colspan="2"><strong>Class Rank</strong></td>
                            <td colspan="12" class="text-center" id="classRank">-</td>
                        </tr>
                        <tr class="table-secondary">
                            <td colspan="2"><strong>Promoted To</strong></td>
                            <td colspan="12" class="text-center" id="promotedTo" style="background-color: #e8f9fa;">-</td>
                        </tr>
                    </tfoot>
                </table>
            </div>



            <div class="row">
                <div class="col-6">
                    <div class="co-scholastic-area">
                        <h6><strong>Co-Scholastic Area:</strong></h6>
                        <table class="table table-bordered" style="font-weight: bold;">
                            <thead>
                                <tr>
                                    <th>Activity</th>
                                    <th>Grade</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>Art Education</td>
                                    <td><input type="text" id="artEducation" class="form-control form-control-sm"></td>
                                </tr>
                                 <tr class="no-printt">
                                    <td>Moral Education</td>
                                    <td><input type="text" id="moralEducation" class="form-control form-control-sm"></td>
                                </tr>
                                  <tr class="no-printt">
                                    <td>Cursive</td>
                                    <td><input type="text" id="cursive" class="form-control form-control-sm"></td>
                                </tr>
                                <tr>
                                    <td>Responsibility</td>
                                    <td><input type="text" id="responsibility" class="form-control form-control-sm">
                                    </td>
                                </tr>
                                <tr>
                                    <td>Cleanliness</td>
                                    <td><input type="text" id="cleanliness" class="form-control form-control-sm"></td>
                                </tr>
                                <tr>
                                    <td>Punctuality</td>
                                    <td><input type="text" id="punctuality" class="form-control form-control-sm"></td>
                                </tr>
                                <tr>
                                    <td>Discipline</td>
                                    <td><input type="text" id="discipline" class="form-control form-control-sm"></td>
                                </tr>

                                <tr>
                                    <td>Participation in CCA</td>
                                    <td><input type="text" id="participationInCCA" class="form-control form-control-sm">
                                    </td>
                                </tr>
                                <tr>
                                    <td>Communication Skill</td>
                                    <td><input type="text" id="communication" class="form-control form-control-sm"></td>
                                </tr>

                            </tbody>
                        </table>


                    </div>
                </div>
                <div class="col-6">
                    <div class="signatures">
                        <h6 style="color:#0fd651"><strong> Class Teacher's Remarks:</strong></h6>
                        <select id="teacherRemarks" class="form-control" style="white-space: pre-wrap; font-weight: bold;">
                            <option value="">Select Remarks</option>
                            <option
                                value="Outstanding performance! Your dedication and hard work have yielded exceptional results. Keep up the excellent work!">
                                Outstanding performance! Your dedication and hard work have yielded exceptional results.
                                Keep up the excellent work!</option>
                            <option
                                value="Very good performance! You have shown great understanding and consistency in your studies.">
                                Very good performance! You have shown great understanding and consistency in your
                                studies.</option>
                            <option
                                value="Good performance. With more focused effort, you can achieve even better results.">
                                Good performance. With more focused effort, you can achieve even better results.
                            </option>
                            <option value="Satisfactory performance. Need to work harder to improve your grades.">
                                Satisfactory performance. Need to work harder to improve your grades.</option>
                            <option
                                value="Performance needs improvement. Regular study and practice will help you achieve better results.">
                                Performance needs improvement. Regular study and practice will help you achieve better
                                results.</option>
                        </select>
                        <div class="text-center" style="margin-top: 50px;">
                            <div class="signature-line"></div>
                            <p class="mb-0">Class Teacher</p>
                        </div>
                        <div class="text-center" style="margin-top: 50px;">
                            <div class="signature-line"></div>
                            <p class="mb-0">Principal</p>
                        </div>
                        <div class="text-center" style="margin-top: 50px;">
                            <div class="signature-line"></div>
                            <p class="mb-0">Parent's Signature</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Add Attendance Section -->
            <div class="row">
                <div class="col-6">
                    <div class="attendance mt-0">
                        <h6><strong>Attendance:</strong></h6>
                        <table class="table table-bordered" style="font-weight: bold;">
                            <tbody>
                                <tr>
                                    <td>Total Days</td>
                                    <td><input type="number" id="totalDays" class="form-control form-control-sm"
                                            min="0"></td>
                                </tr>
                                <tr>
                                    <td>Days Present</td>
                                    <td><input type="number" id="daysPresent" class="form-control form-control-sm"
                                            min="0"></td>
                                </tr>
                                <tr>
                                    <td>Percentage</td>
                                    <td id="attendancePercentage">-</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>



                <div class="col-6">
                    <h6><strong>Grading System:</strong></h6>
                    <p class="mb-0">A1 (91-100): Outstanding | A2 (81-90): Excellent</p>
                    <p class="mb-0">B1 (71-80): Very Good | B2 (61-70): Good</p>

                    <p class="mb-0">C1 (51-60): Fair | C2 (41-50): Average</p>
                    <p class="mb-0">D (33-40): Below Average | E (Below 33): Needs Improvement</p>
                </div>

            </div>
            <!-- 			<div class="row mt-4">                            
                            
                        </div> -->

            <div class="result-summary">
                <div class="row mb-1">
                    <div class="col-6">
                        <p class="mb-0"><strong>Overall Percentage:</strong> <span id="overallPercentage">0</span>%</p>
                    </div>
                    <div class="col-6">
                        <p class="mb-0"><strong>Overall Grade:</strong> <span id="overallGrade">-</span></p>
                    </div>
                </div>
                <div class="row">
                    <div class="col-6">
                        <p class="mb-0"><strong>Result:</strong> <span id="finalResult">-</span></p>
                    </div>
                    <div class="col-6">
                        <p class="mb-0"><strong>Rank in Class:</strong> <span id="classRank">-</span></p>
                    </div>
                </div>
            </div>
        </div>
        <div class="corner corner-top-left"></div>
        <div class="corner corner-top-right"></div>
        <div class="corner corner-bottom-left"></div>
        <div class="corner corner-bottom-right"></div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="../js/config.js"></script>
    <script>  
        const API_BASE_URL = CONFIG.API_URL;
        let studentId, className, section, marksExist = false;
        // Global exam config
        let examConfig = {
            examConfigs: [
                { examType: 'pt1', maxMarksWritten: 80, maxMarksOral: 20 },
                { examType: 'hy', maxMarksWritten: 80, maxMarksOral: 20 },
                { examType: 'pt2', maxMarksWritten: 80, maxMarksOral: 20 },
                { examType: 'final', maxMarksWritten: 80, maxMarksOral: 20 }
            ]
        };

        // Function to get authentication token
        function getAuthToken() {
             //return localStorage.getItem("skyview_token");
            return localStorage.getItem(CONFIG.STORAGE_KEYS.TOKEN);
        }

        // Function to make authenticated API calls
        async function apiCall(url, options = {}) {
            const token = getAuthToken();
            if (!token) {
                window.location.href = '../pages/login.html';
                throw new Error('Authentication required');
            }

            const headers = {
                'Content-Type': 'application/json',
                'Authorization': `Bearer ${token}`,
                ...options.headers
            };

            return fetch(url, { ...options, headers });
        }

          // Load exam configuration
        async function loadExamConfig() {
            try {
                const academicYear = '2024-2025';
                const response = await apiCall(`${API_BASE_URL}/exam/config/${encodeURIComponent(className)}/${encodeURIComponent(section)}/${encodeURIComponent(academicYear)}`);
                
                if (!response.ok) {
                    // Create a new config
                    const defaultConfig = {
                        class: className,
                        section: section,
                        academicYear: academicYear,
                        examConfigs: [
                            { examType: 'pt1', maxMarksWritten: 80, maxMarksOral: 20 },
                            { examType: 'hy', maxMarksWritten: 80, maxMarksOral: 20 },
                            { examType: 'pt2', maxMarksWritten: 80, maxMarksOral: 20 },
                            { examType: 'final', maxMarksWritten: 80, maxMarksOral: 20 }
                        ]
                    };

                    // Save the default config
                    const saveResponse = await apiCall(`${API_BASE_URL}/exam/config`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(defaultConfig)
                    });

                    if (!saveResponse.ok) {
                        console.error('Failed to save default exam config');
                        return false;
                    }

                    const savedConfig = await saveResponse.json();
                    examConfig = savedConfig;
                } else {
                    const data = await response.json();
                    examConfig = data;
                }

                console.log('Using exam config:', examConfig);

                // Update max marks in the table header for all exam types
                ['pt1', 'hy', 'pt2', 'final'].forEach(examType => {
                    const currentConfig = examConfig.examConfigs.find(config => config.examType === examType) || 
                           { maxMarksWritten: 80, maxMarksOral: 20 };
            
                    document.getElementById(`${examType}WrittenMax`).textContent = `(${currentConfig.maxMarksWritten})`;
                    document.getElementById(`${examType}OralMax`).textContent = `(${currentConfig.maxMarksOral})`;
                    document.getElementById(`${examType}TotalMax`).textContent = `(${currentConfig.maxMarksWritten + currentConfig.maxMarksOral})`;
                });
                return true;
            } catch (error) {
                console.error('Error loading exam config:', error);
                return false;
            }
        }
        // Function to get max marks for an exam type
        function getMaxMarks(examType) {
            const currentConfig = examConfig.examConfigs.find(config => config.examType === examType) || 
                { maxMarksWritten: 80, maxMarksOral: 20 };
            
            return {
                written: currentConfig.maxMarksWritten,
                oral: currentConfig.maxMarksOral,
                total: currentConfig.maxMarksWritten + currentConfig.maxMarksOral
            };
        }
        async function updatePromotionClass() {
            const promotionMap = {
                "NURSERY": "LKG",
                "LKG": "UKG",
                "UKG": "I",
                "I": "II",
                "II": "III",
                "III": "IV",
                "IV": "V",
                "V": "VI",
                "VI": "VII",
                "VII": "VIII",
                "VIII": "IX",
                "IX": "X",
                "X": "XI",
                "XI": "XII",
                "XII": "PASS OUT"
            };

            const classInput = document.getElementById('className');
            const promotionInput = document.getElementById('promotedTo');

            if (classInput && promotionInput) {
                const selectedClass = classInput.textContent.toUpperCase();
                promotionInput.textContent = promotionMap[selectedClass] || "-";
            }
        }

        // // Load marksheet data when page loads
        // document.addEventListener('DOMContentLoaded', async () => {
        //     const urlParams = new URLSearchParams(window.location.search);
        //     studentId = urlParams.get('studentId');
        //     // Get class from either className or class parameter
        //     className = urlParams.get('className') || urlParams.get('class'); 
        //     section = urlParams.get('section');
        //     rollNo = urlParams.get('rollNo');
        //     const studentName = urlParams.get('studentName');
        //     const admissionNo = urlParams.get('admissionNo');
        //     const dob = urlParams.get('dob');
        //     const shouldPrint = urlParams.get('print') === 'true';

        //     console.log('URL Parameters:', Object.fromEntries(urlParams.entries()));

        //     if (!studentId || !className || !section) {
        //         alert('Required parameters are missing');
        //         return;
        //     }

        //     // Set student info
        //     document.getElementById('studentName').textContent = studentName || '-';
        //     document.getElementById('admissionNo').textContent = admissionNo || '-';
        //     document.getElementById('className').textContent = className || '-';
        //     document.getElementById('section').textContent = section || '-';
        //     document.getElementById('rollNo').textContent = rollNo || '-';
        //     document.getElementById('dob').textContent = dob || '-';
        //     document.getElementById('academicYear').textContent = '2024-2025';

        //      // Load exam config first and ensure it's loaded before proceeding
        //     const configLoaded = await loadExamConfig();
        //     if (!configLoaded) {
        //         alert('Failed to load exam configuration. Please refresh the page.');
        //         return;
        //     }
        //     console.log('Using exam config:', examConfig);

        //     // // Set promoted class before loading marksheet
        //     // updatePromotionClass();

        //     await loadMarksheet();
        //      // Set promoted class after loading marksheet
        //         await updatePromotionClass();

        //     // Add save button click handler
        //     document.getElementById('saveMarks').addEventListener('click', saveStudentMarks);

        //     // Select all input fields in the co-scholastic area
        //     // Convert grades inside input fields **after a short delay**
        //     setTimeout(() => {
        //         const gradeElements = document.querySelectorAll(".co-scholastic-area input");
        //         gradeElements.forEach(element => {
        //             const originalGrade = element.value.trim();
        //             if (originalGrade) {
        //                 element.value = convertGrade(originalGrade);
        //             }
        //         });
        //     }, 500); // Delayed execution to ensure inputs are filled

     
        //     // Auto print if requested
        //     if (shouldPrint) {
        //         // Hide action buttons before printing
        //         const actionButtons = document.querySelectorAll('.no-print');
        //         actionButtons.forEach(btn => btn.style.display = 'none');

        //         // Wait for a moment to ensure everything is loaded
        //         setTimeout(() => {
        //             window.print();
        //         }, 1000);
        //     }
        // });

    document.addEventListener('DOMContentLoaded', async () => {
    const urlParams = new URLSearchParams(window.location.search);
    studentId = urlParams.get('studentId');
    className = urlParams.get('className') || urlParams.get('class'); 
    section = urlParams.get('section');
    rollNo = urlParams.get('rollNo');
    const studentName = urlParams.get('studentName');
    const admissionNo = urlParams.get('admissionNo');
    const dob = urlParams.get('dob');
    const shouldPrint = urlParams.get('print') === 'true';

    console.log('URL Parameters:', Object.fromEntries(urlParams.entries()));

    if (!studentId || !className || !section) {
        alert('Required parameters are missing');
        return;
    }

    // Set student info
    document.getElementById('studentName').textContent = studentName || '-';
    document.getElementById('admissionNo').textContent = admissionNo || '-';
    document.getElementById('className').textContent = className || '-';
    document.getElementById('section').textContent = section || '-';
    document.getElementById('rollNo').textContent = rollNo || '-';
    document.getElementById('dob').textContent = dob || '-';
    document.getElementById('academicYear').textContent = '2024-2025';

    // Load exam config first
    const configLoaded = await loadExamConfig();
    if (!configLoaded) {
        alert('Failed to load exam configuration. Please refresh the page.');
        return;
    }
    console.log('Using exam config:', examConfig);

    await loadMarksheet();
    await updatePromotionClass();

    document.getElementById('saveMarks').addEventListener('click', saveStudentMarks);

    // Convert co-scholastic grades after a short delay
    setTimeout(() => {
        const gradeElements = document.querySelectorAll(".co-scholastic-area input");
        gradeElements.forEach(element => {
            const originalGrade = element.value.trim();
            if (originalGrade) {
                element.value = convertGrade(originalGrade);
            }
        });
    }, 500);

    // ✅ Hide Rank Row if Rank > 10
    function checkAndHideRank() {
        let classRankTd = document.getElementById("classRank");

        if (classRankTd) {
            let rankValue = parseInt(classRankTd.textContent.replace(/\D/g, ""), 10);
            console.log("Detected Rank:", rankValue); // Debugging Log

            if (!isNaN(rankValue) && rankValue > 10) {
                console.log(`Hiding row because class rank is: ${rankValue}`);
                classRankTd.closest("tr").style.display = "none"; // Hide row
                observer.disconnect(); // Stop observing after hiding
            }
        }
    }

    // ✅ Observe Rank Changes
    const observer = new MutationObserver(() => {
        checkAndHideRank();
    });

    // ✅ Check if #classRank is available & observe changes
    const checkExist = setInterval(() => {
        let targetNode = document.getElementById("classRank");
        if (targetNode) {
            observer.observe(targetNode, { childList: true, subtree: true });
            console.log("Observing #classRank for changes...");
            clearInterval(checkExist);
            checkAndHideRank(); // Check once immediately
        }
    }, 500); // Check every 500ms

    // Auto print if requested
    if (shouldPrint) {
        const actionButtons = document.querySelectorAll('.no-print');
        actionButtons.forEach(btn => btn.style.display = 'none');

        setTimeout(() => {
            window.print();
        }, 1000);
    }
});

        // Add event listeners for attendance calculation
        document.getElementById('totalDays').addEventListener('input', updateAttendancePercentage);
        document.getElementById('daysPresent').addEventListener('input', updateAttendancePercentage);

        // Function to update attendance percentage
        function updateAttendancePercentage() {
            const totalDays = parseInt(document.getElementById('totalDays').value) || 0;
            const daysPresent = parseInt(document.getElementById('daysPresent').value) || 0;

            // Validate that days present doesn't exceed total days
            if (daysPresent > totalDays) {
                alert('Days present cannot exceed total days');
                document.getElementById('daysPresent').value = totalDays;
                return;
            }

            const percentage = totalDays > 0 ? ((daysPresent / totalDays) * 100).toFixed(1) : 0;
            document.getElementById('attendancePercentage').textContent = percentage + '%';
        }

        // Load marksheet data
        async function loadMarksheet() {
            try {
                // Get class data to know subjects
                const classResponse = await apiCall(`${API_BASE_URL}/classes/details/${encodeURIComponent(className)}/${encodeURIComponent(section)}`);
                if (!classResponse.ok) throw new Error('Failed to fetch class data');
                const classData = await classResponse.json();

                // Get existing marks if any
                let marksData = null;
                try {
                    const marksResponse = await apiCall(`${API_BASE_URL}/marks/${studentId}`);
                    if (marksResponse.ok) {
                        marksData = await marksResponse.json();
                        marksExist = true;

                        // Update class rank if it exists
                        if (marksData.rank) {
                            document.getElementById('classRank').textContent = `#${marksData.rank}`;
                            document.getElementById('classRank').style.backgroundColor = '#e8f9fa';
                        }

                        // Update promoted class again after getting marks data
                        updatePromotionClass();
                    }
                } catch (error) {
                    console.log('No existing marks found');
                }

                // Create table rows
                const tbody = document.getElementById('marksTableBody');
                tbody.innerHTML = '';

                classData.subjects.forEach(subject => {
                    const subjectMarks = marksData?.marks?.find(m => m.subject === subject.name) || {};
                    const tr = addSubjectRow(subject.name, subjectMarks);
                    tbody.appendChild(tr);
                });

                // Calculate totals if marks exist
                if (marksData) {
                    updateExamTotals();
                    updateOverallResults();
                }

                // Load co-scholastic grades
                if (marksData.coScholastic) {
                    document.getElementById('artEducation').value = marksData.coScholastic.artEducation || '';
                    document.getElementById('moralEducation').value = marksData.coScholastic.moralEducation || '';
                    document.getElementById('cursive').value = marksData.coScholastic.cursive || '';
                    document.getElementById('responsibility').value = marksData.coScholastic.responsibility || '';
                    document.getElementById('cleanliness').value = marksData.coScholastic.cleanliness || '';
                    document.getElementById('punctuality').value = marksData.coScholastic.punctuality || '';
                    document.getElementById('discipline').value = marksData.coScholastic.discipline || '';
                    document.getElementById('participationInCCA').value = marksData.coScholastic.participationInCCA || '';
                    document.getElementById('communication').value = marksData.coScholastic.communication || '';
                }

                // Load attendance data
                if (marksData.attendance) {
                    document.getElementById('totalDays').value = marksData.attendance.totalDays || '';
                    document.getElementById('daysPresent').value = marksData.attendance.daysPresent || '';
                    updateAttendancePercentage();
                }

                // Load teacher remarks
                if (marksData.teacherRemarks) {
                    document.getElementById('teacherRemarks').value = marksData.teacherRemarks;
                }
            } catch (error) {
                console.error('Error loading marksheet:', error);
                alert('Failed to load marksheet data');
            }
        }

        // Add event listeners for attendance calculation
        document.getElementById('totalDays').addEventListener('input', updateAttendancePercentage);
        document.getElementById('daysPresent').addEventListener('input', updateAttendancePercentage);

        // Function to update attendance percentage
        function updateAttendancePercentage() {
            const totalDays = parseInt(document.getElementById('totalDays').value) || 0;
            const daysPresent = parseInt(document.getElementById('daysPresent').value) || 0;

            // Validate that days present doesn't exceed total days
            if (daysPresent > totalDays) {
                alert('Days present cannot exceed total days');
                document.getElementById('daysPresent').value = totalDays;
                return;
            }

            const percentage = totalDays > 0 ? ((daysPresent / totalDays) * 100).toFixed(1) : 0;
            document.getElementById('attendancePercentage').textContent = percentage + '%';
        }

      
        // Create exam cells with input fields
        function createExamCells(examType, subject, marks = {}) {
            const written = marks[examType]?.written || '';
            const oral = marks[examType]?.oral || '';
            const total = (written !== '' && oral !== '') ? parseFloat(written) + parseFloat(oral) : '';

            return `
                <td class="text-center">
                    <input type="number" min="0" max="80" class="form-control form-control-sm text-center marks-input" 
                        data-subject="${subject}" data-exam="${examType}" data-type="written" value="${written}"
                        onchange="updateTotal(this)">
                </td>
                <td class="text-center">
                    <input type="number" min="0" max="20" class="form-control form-control-sm text-center marks-input" 
                        data-subject="${subject}" data-exam="${examType}" data-type="oral" value="${oral}"
                        onchange="updateTotal(this)">
                </td>
                <td class="total-cell text-center">${total}</td>
            `;
        }

        // Add a row for each subject
        function addSubjectRow(subject, marks = {}) {
            const tr = document.createElement('tr');
            tr.className = 'subject-row';
            tr.setAttribute('data-subject', subject);
            tr.innerHTML = `
                <td>${subject}</td>
                ${createExamCells('pt1', subject, marks)}
                ${createExamCells('hy', subject, marks)}
                ${createExamCells('pt2', subject, marks)}
                ${createExamCells('final', subject, marks)}
            `;
            document.getElementById('marksTableBody').appendChild(tr);
            return tr;
        }

        // Update total when marks are entered
        function updateTotal(input) {
            const tr = input.closest('tr');
            const examType = input.dataset.exam;
            const writtenInput = tr.querySelector(`input[data-exam="${examType}"][data-type="written"]`);
            const oralInput = tr.querySelector(`input[data-exam="${examType}"][data-type="oral"]`);

            // Get written and oral marks
            const written = parseFloat(writtenInput.value) || 0;
            const oral = parseFloat(oralInput.value) || 0;

            // Validate marks
            if (written > 80) {
                writtenInput.value = 80;
                alert('Written marks cannot exceed 80');
                return;
            }
            if (oral > 20) {
                oralInput.value = 20;
                alert('Oral marks cannot exceed 20');
                return;
            }

            // Find the total cell (it's the next cell after oral input)
            const totalCell = oralInput.closest('td').nextElementSibling;
            if (!totalCell) {
                console.error('Total cell not found');
                return;
            }

            // Update total cell
            totalCell.textContent = (written + oral).toFixed(1);
            totalCell.style.backgroundColor = (written > 0 || oral > 0) ? '#e8f9fa' : '';

            // Update exam totals and percentages
            updateExamTotals();
            updateOverallResults();
        }

        // Update exam totals and percentages
        function updateExamTotals() {
            const examTypes = ['pt1', 'hy', 'pt2', 'final'];
            let totalMarks = 0;
            let totalMaxMarks = 0;

            examTypes.forEach(examType => {
                let examTotal = 0;
                let examMaxTotal = 0;
                const rows = document.querySelectorAll('#marksTableBody tr');

                rows.forEach(row => {
                    const writtenInput = row.querySelector(`input[data-exam="${examType}"][data-type="written"]`);
                    const oralInput = row.querySelector(`input[data-exam="${examType}"][data-type="oral"]`);
                    
                    if (writtenInput && oralInput) {
                        const written = parseFloat(writtenInput.value) || 0;
                        const oral = parseFloat(oralInput.value) || 0;
                        const maxMarks = getMaxMarks(examType);
                        
                        examTotal += written + oral;
                        examMaxTotal += maxMarks.total;
                    }
                });

                // Update exam total
                document.getElementById(`${examType}Total`).textContent = examTotal.toFixed(1);

                // Calculate and update percentage
                const percentage = examMaxTotal > 0 ? (examTotal / examMaxTotal * 100).toFixed(1) : '0.0';
                document.getElementById(`${examType}Percentage`).textContent = percentage + '%';

                // Add to overall totals if marks were entered
                if (examTotal > 0) {
                    totalMarks += examTotal;
                    totalMaxMarks += examMaxTotal;
                }
            });

            // Calculate and update overall percentage
            const overallPercentage = totalMaxMarks > 0 ? (totalMarks / totalMaxMarks * 100).toFixed(1) : '0.0';
            document.getElementById('overallPercentage').textContent = overallPercentage + '%';
            document.getElementById('overallGrade').textContent = calculateGrade(overallPercentage);
        }

        // Update overall results
        function updateOverallResults() {
            const examTypes = ['pt1', 'hy', 'pt2', 'final'];
            let totalMarks = 0;
            let totalMaxMarks = 0;

            examTypes.forEach(examType => {
                const rows = document.querySelectorAll('#marksTableBody tr');
                let examTotal = 0;
                let examMaxTotal = 0;

                rows.forEach(row => {
                    const writtenInput = row.querySelector(`input[data-exam="${examType}"][data-type="written"]`);
                    const oralInput = row.querySelector(`input[data-exam="${examType}"][data-type="oral"]`);
                    
                    if (writtenInput && oralInput) {
                        const written = parseFloat(writtenInput.value) || 0;
                        const oral = parseFloat(oralInput.value) || 0;
                        const maxMarks = getMaxMarks(examType);
                        
                        examTotal += written + oral;
                        examMaxTotal += maxMarks.total;
                    }
                });

                // Add to overall totals if marks were entered
                if (examTotal > 0) {
                    totalMarks += examTotal;
                    totalMaxMarks += examMaxTotal;
                }
            });

            // Calculate and update overall percentage
            const overallPercentage = totalMaxMarks > 0 ? (totalMarks / totalMaxMarks * 100).toFixed(1) : '0.0';
            document.getElementById('overallPercentage').textContent = overallPercentage + '%';
            document.getElementById('overallGrade').textContent = calculateGrade(overallPercentage);
            updateTeacherRemarks();
        }


        // Calculate grade based on percentage
        function calculateGrade(percentage) {
            if (percentage >= 91) return 'A1 - Outstanding';
            if (percentage >= 81) return 'A2 - Excellent';
            if (percentage >= 71) return 'B1 - Very Good';
            if (percentage >= 61) return 'B2 - Good';
            if (percentage >= 51) return 'C1 - Fair';
            if (percentage >= 41) return 'C2 - Average';
            if (percentage >= 33) return 'D - Below Average';
            return 'E - Needs Improvement';
        }

        // Function to update teacher remarks based on overall percentage
        function updateTeacherRemarks() {
            const overallPercentage = parseFloat(document.getElementById('overallPercentage').textContent) || 0;
            const remarksSelect = document.getElementById('teacherRemarks');

            if (overallPercentage >= 90) {
                remarksSelect.selectedIndex = 1; // Outstanding
            } else if (overallPercentage >= 75) {
                remarksSelect.selectedIndex = 2; // Very good
            } else if (overallPercentage >= 60) {
                remarksSelect.selectedIndex = 3; // Good
            } else if (overallPercentage >= 45) {
                remarksSelect.selectedIndex = 4; // Satisfactory
            } else {
                remarksSelect.selectedIndex = 5; // Needs improvement
            }
        }

        // Save student marks
        async function saveStudentMarks() {
            const saveBtn = document.getElementById('saveMarks');
            saveBtn.disabled = true;
            saveBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Saving...';

            try {
                // Get all subject rows
                const subjectRows = document.querySelectorAll('.subject-row');
                const marksData = [];

                // Collect marks for each subject
                subjectRows.forEach(row => {
                    const subject = row.getAttribute('data-subject');
                    if (!subject) {
                        console.error('Subject not found for row:', row);
                        return;
                    }

                    const marks = {
                        subject,
                        pt1: getExamMarks(row, 'pt1'),
                        hy: getExamMarks(row, 'hy'),
                        pt2: getExamMarks(row, 'pt2'),
                        final: getExamMarks(row, 'final')
                    };

                    // Only add if at least one exam has marks
                    if (Object.values(marks).some(exam =>
                        exam && (
                            (exam.written !== null && exam.written !== '') ||
                            (exam.oral !== null && exam.oral !== '')
                        )
                    )) {
                        marksData.push(marks);
                    }
                });

                if (marksData.length === 0) {
                    throw new Error('Please enter marks for at least one subject before saving.');
                }

                // Prepare data for API
                const urlParams = new URLSearchParams(window.location.search);
                const data = {
                    studentId: urlParams.get('studentId'),
                    className: urlParams.get('className'),
                    section: urlParams.get('section'),
                    rollNo: document.getElementById('rollNo').textContent,
                    studentName: urlParams.get('studentName'),
                    admissionNo: urlParams.get('admissionNo'),
                    fatherName: urlParams.get('fatherName'),
                    academicYear: document.getElementById('academicYear').textContent,
                    marks: marksData,
                    coScholastic: {
                        artEducation: document.getElementById('artEducation').value,
                        moralEducation: document.getElementById('moralEducation').value,
                        cursive: document.getElementById('cursive').value,
                        responsibility: document.getElementById('responsibility').value,
                        cleanliness: document.getElementById('cleanliness').value,
                        punctuality: document.getElementById('punctuality').value,
                        discipline: document.getElementById('discipline').value,
                        participationInCCA: document.getElementById('participationInCCA').value,
                        communication: document.getElementById('communication').value
                    },
                    attendance: {
                        totalDays: parseInt(document.getElementById('totalDays').value) || 0,
                        daysPresent: parseInt(document.getElementById('daysPresent').value) || 0
                    },
                    teacherRemarks: document.getElementById('teacherRemarks').value
                };

                // Validate required fields
                if (!data.studentId) throw new Error('Student ID is missing');
                if (!data.className) throw new Error('Class is missing');
                if (!data.section) throw new Error('Section is missing');
                if (!data.academicYear) throw new Error('Academic year is missing');
                if (!data.studentName) throw new Error('Student name is missing');
                if (!data.admissionNo) throw new Error('Admission number is missing');
                if (!data.fatherName) throw new Error('Father name is missing');

                // First check if marks exist
                const checkResponse = await fetch(`${CONFIG.API_URL}/marks/${data.studentId}`, {
                    headers: {
                        'Authorization': `Bearer ${getAuthToken()}`
                    }
                });

                let method, url;
                if (checkResponse.status === 404) {
                    // If marks don't exist, create new ones
                    method = 'POST';
                    url = `${CONFIG.API_URL}/marks`;
                } else {
                    // If marks exist, update them
                    method = 'PUT';
                    url = `${CONFIG.API_URL}/marks/${data.studentId}`;
                }

                console.log('Saving marks data:', data);

                const response = await fetch(url, {
                    method: method,
                    headers: {
                        'Authorization': `Bearer ${getAuthToken()}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(data)
                });

                if (!response.ok) {
                    const error = await response.json();
                    throw new Error(error.message || `Failed to save marks: ${response.status} ${response.statusText}`);
                }

                const result = await response.json();
                console.log('Marks saved successfully:', result);

                saveBtn.className = 'btn btn-success';
                saveBtn.innerHTML = '<i class="fas fa-check"></i> Marks Saved!';
                setTimeout(() => {
                    saveBtn.disabled = false;
                    saveBtn.innerHTML = '<i class="fas fa-save"></i> Save Marks';
                }, 2000);

                alert('Marks saved successfully!');
            } catch (error) {
                console.error('Error saving marks:', error);
                saveBtn.className = 'btn btn-danger';
                saveBtn.innerHTML = '<i class="fas fa-exclamation-triangle"></i> Save Failed';
                setTimeout(() => {
                    saveBtn.disabled = false;
                    saveBtn.className = 'btn btn-success';
                    saveBtn.innerHTML = '<i class="fas fa-save"></i> Save Marks';
                }, 2000);
                alert(error.message || 'Failed to save marks. Please try again.');
            }
        }

       // Get exam marks from inputs
     
            function getExamMarks(row, examType) {
            const writtenInput = row.querySelector(`input[data-exam="${examType}"][data-type="written"]`);
            const oralInput = row.querySelector(`input[data-exam="${examType}"][data-type="oral"]`);

            if (!writtenInput || !oralInput) {
                return null;
            }

            const written = writtenInput.value.trim();
            const oral = oralInput.value.trim();

            // If both marks are empty, skip this exam
            if (written === '' && oral === '') {
                return null;
            }

            // Convert to numbers, empty values become 0
            const writtenNum = written === '' ? 0 : Number(written);
            const oralNum = oral === '' ? 0 : Number(oral);

            // Get max marks from exam config
            const currentConfig = examConfig.examConfigs.find(config => config.examType === examType) || 
                           { maxMarksWritten: 80, maxMarksOral: 20 };

            // Validate marks - allow 0 marks without validation
            if (writtenNum !== 0 && writtenNum > currentConfig.maxMarksWritten) {
                writtenInput.classList.add('error');
                writtenInput.title = `Maximum allowed marks is ${currentConfig.maxMarksWritten}`;
                return null;
            }
            if (oralNum !== 0 && oralNum > currentConfig.maxMarksOral) {
                oralInput.classList.add('error');
                oralInput.title = `Maximum allowed marks is ${currentConfig.maxMarksOral}`;
                return null;
            }

            // Clear any previous validation errors
            writtenInput.classList.remove('error');
            writtenInput.title = '';
            oralInput.classList.remove('error');
            oralInput.title = '';

            // Return exam data with maxMarks
            return {
                written: writtenNum,
                oral: oralNum,
                maxMarksWritten: currentConfig.maxMarksWritten,
                maxMarksOral: currentConfig.maxMarksOral
            };
        }
          function convertGrade(grade) {
            if (!grade) return ""; // Keep input empty if no grade is entered
        
            switch (grade.toUpperCase()) {
                case 'A+': return 'A1';
                case 'A': return 'A2';
                case 'B+': return 'B1';
                case 'B': return 'B2';
                default: return grade;
            }
        }

    </script>
</body>
</html>
